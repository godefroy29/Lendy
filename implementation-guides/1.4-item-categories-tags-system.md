# 1.4 Item Categories/Tags System

**Priority:** Medium  
**Category:** New Functionality  
**Status:** ❌ Not Implemented  
**Difficulty:** 7 ⭐⭐⭐⭐⭐⭐⭐  
**Modification Location:** Flutter Code + Supabase

## Description

Allow users to categorize items (e.g., Books, Tools, Electronics, Clothing).

## Implementation Details

- Add `category` field to `Item` entity (String? nullable)
- Update Supabase database schema to add `category` column to items table
- Add category dropdown/selector in `CreateItemScreen` and `EditItemScreen`
- Predefined categories: Books, Tools, Electronics, Clothing, Games, Other
- Allow custom category input (optional)
- Add category filter in `ItemsListScreen` (filter chips or dropdown)
- Update `ItemCard` to display category badge/chip
- Update `ItemDetailScreen` to show category
- Update repository methods to support category filtering
- Add category to search functionality

## Files to Modify

- **Modify:** `lendy/lib/domain/entities/item.dart` (add category field)
- **Modify:** `lendy/lib/presentation/screens/create_item_screen.dart`
- **Modify:** `lendy/lib/presentation/screens/edit_item_screen.dart` (when created)
- **Modify:** `lendy/lib/presentation/screens/items_list_screen.dart` (add filter)
- **Modify:** `lendy/lib/presentation/widgets/item_card.dart` (display category)
- **Modify:** `lendy/lib/presentation/screens/item_detail_screen.dart`
- **Modify:** `lendy/lib/data/repositories/supabase_item_repository.dart` (add category filter)

## Dependencies

Database migration required

## Supabase Database Migration

### Step 1: Add Category Column to Items Table

1. **Open Supabase Dashboard:**
   - Navigate to your Supabase project dashboard
   - Go to **SQL Editor** or **Table Editor**

2. **Run SQL Migration:**
   ```sql
   -- Add category column to items table
   ALTER TABLE items 
   ADD COLUMN category TEXT;
   
   -- Add comment to document the column
   COMMENT ON COLUMN items.category IS 'Category of the item (e.g., Books, Tools, Electronics, Clothing)';
   ```

3. **Optional: Add Index for Performance:**
   ```sql
   -- Create index on category for faster filtering
   CREATE INDEX idx_items_category ON items(category);
   ```

4. **Optional: Add Check Constraint (if you want to restrict to predefined categories):**
   ```sql
   -- Only if you want to enforce predefined categories at database level
   -- ALTER TABLE items 
   -- ADD CONSTRAINT check_category 
   -- CHECK (category IS NULL OR category IN ('Books', 'Tools', 'Electronics', 'Clothing', 'Games', 'Other'));
   ```
   **Note:** This constraint is optional. If you allow custom categories, do NOT add this constraint.

5. **Verify the Migration:**
   - Check that the `category` column appears in the `items` table
   - Verify the column is nullable (allows NULL values)
   - Test that existing items have NULL category (which is expected)

### Step 2: Update Row Level Security (RLS) Policies (if needed)

If you have RLS policies that reference specific columns, you may need to update them. However, since `category` is just a filter field and doesn't affect access control, existing RLS policies should continue to work.

### Step 3: Test Database Changes

1. **Test Insert:**
   ```sql
   -- Test inserting an item with a category
   INSERT INTO items (user_id, title, borrower_name, lent_at, status, category)
   VALUES ('test-user-id', 'Test Item', 'Test Borrower', NOW(), 'lent', 'Books');
   ```

2. **Test Query with Category Filter:**
   ```sql
   -- Test filtering by category
   SELECT * FROM items WHERE category = 'Books';
   ```

3. **Test NULL Category (for existing items):**
   ```sql
   -- Verify existing items can have NULL category
   SELECT * FROM items WHERE category IS NULL;
   ```

## Implementation Steps

1. **Database Migration:** Complete Supabase migration steps above
2. Update `Item` entity to include `category` field
3. Add category selector to create/edit screens (dropdown with predefined + custom option)
4. Update repository methods to filter by category
5. Add category filter UI to `ItemsListScreen` (chips or dropdown)
6. Display category badge in `ItemCard` and `ItemDetailScreen`
7. Include category in search functionality
8. Test category filtering and display
